<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cek Stok Kilat (CSK)</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: #F8F9FA;
            padding-bottom: 80px;
        }
        
        .navbar {
            background-color: #007BFF !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1001;
        }
        
        .video-banner {
            position: relative;
            width: 100%;
            height: 250px;
            overflow: hidden;
            background: #000;
        }
        
        .video-banner video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 123, 255, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .video-overlay h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .video-overlay p {
            font-size: 1rem;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        @media (max-width: 768px) {
            .video-banner {
                height: 180px;
            }
            
            .video-overlay h2 {
                font-size: 1.3rem;
            }
            
            .video-overlay p {
                font-size: 0.9rem;
            }
        }
        
        .catalog-section {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .catalog-title {
            text-align: center;
            color: #007BFF;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .catalog-title i {
            margin-right: 8px;
        }
        
        #productCarousel {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .carousel-item {
            height: 300px;
        }
        
        .carousel-item img {
            max-height: 280px;
            object-fit:contain;
        }
        
        .carousel-caption {
            background: rgba(0, 123, 255, 0.85);
            padding: 15px;
            border-radius: 8px;
            bottom: 20px;
        }
        
        .carousel-caption h5 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .carousel-caption p {
            font-size: 0.95rem;
            margin: 0;
        }
        
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            background-color: rgba(0, 123, 255, 0.8);
            border-radius: 50%;
            padding: 20px;
        }
        
        .carousel-indicators button {
            background-color: #007BFF;
        }
        
        @media (max-width: 768px) {
            .carousel-item {
                height: 250px;
            }
            
            .carousel-caption h5 {
                font-size: 1.1rem;
            }
            
            .carousel-caption p {
                font-size: 0.85rem;
            }
            
            .catalog-section {
                padding: 15px 0;
            }
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .search-container {
            margin: 20px 0;
        }
        
        .stock-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .stock-card.low-stock {
            background-color: #ffe6e6;
            border-left: 4px solid #DC3545;
        }
        
        .stock-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stock-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #212529;
        }
        
        .stock-code {
            color: #6C757D;
            font-size: 0.9rem;
        }
        
        .stock-quantity {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007BFF;
            font-variant-numeric: tabular-nums;
        }
        
        .stock-quantity.low {
            color: #DC3545;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .btn-action {
            flex: 1;
            font-size: 0.9rem;
            padding: 8px;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #dee2e6;
            padding: 10px 0;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .nav-item-bottom {
            text-align: center;
            color: #6C757D;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: color 0.2s;
        }
        
        .nav-item-bottom:hover {
            color: #007BFF;
        }
        
        .nav-item-bottom i {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }
        
        .nav-item-bottom span {
            font-size: 0.75rem;
        }
        
        .modal-content {
            border-radius: 12px;
        }
        
        .modal-header {
            background-color: #007BFF;
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6C757D;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .badge-warning {
            background-color: #DC3545;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .stats-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .stat-card {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #007BFF;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #6C757D;
            margin-top: 5px;
        }
        
        .item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 10px;
            border: 2px solid #dee2e6;
        }
        
        .item-image.uploaded {
            border-color: #28A745;
        }
        
        .item-content {
            display: flex;
            align-items: center;
        }
        
        .media-preview {
            margin-top: 10px;
        }
        
        .media-preview img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .media-preview video {
            max-width: 100%;
            border-radius: 8px;
        }
        
        #imagePreview {
            text-align: center;
        }
        
        #imagePreview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            object-fit: cover;
        }
        
        .notification {
            position: fixed;
            top: 70px;
            right: 20px;
            background: #28A745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark"> 
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1"> 
                <i class="bi bi-box-seam"></i> Cek Stok Kilat
            </span>
            <button class="btn btn-light btn-sm" onclick="refreshData()">
                <i class="bi bi-arrow-clockwise"></i> 
            </button>
        </div>
    </nav>

    <!-- Video Header Banner -->
    <div class="video-banner">
        <video autoplay muted loop playsinline id="headerVideo">
            <source src="asset/V1.mp4" type="video/mp4">
            Browser Anda tidak mendukung video.
        </video>
        <div class="video-overlay">
            <h2>Kelola Stok dengan Mudah</h2>
            <p>Manajemen inventaris cepat untuk bisnis Anda</p>
        </div>
    </div>

    <!-- Product Catalog Carousel -->
    <div class="catalog-section">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="catalog-title mb-0">
                    <i class="bi bi-images"></i> Katalog Produk Kami
                </h5>
                <button class="btn btn-sm btn-outline-primary" onclick="toggleCatalog()">
                    <i class="bi bi-chevron-up" id="catalogToggleIcon"></i>
                </button>
            </div>
        </div>
        <div id="catalogContent">
            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active"></button>
                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="1"></button>
                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="2"></button>
                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="3"></button>
                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="4"></button>
                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="5"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="Asset/GL.JPG.jpg" class="d-block w-100" alt="Gula Pasir">
                        <div class="carousel-caption">
                            <h5>Gula Pasir</h5>
                            <p>Gula berkualitas untuk kebutuhan harian</p>
                            <button class="btn btn-sm btn-light mt-2" onclick="quickAddFromCatalog('GL001', 'Gula Pasir 1kg', 'asset/GL.JPG.jpg')">
                                <i class="bi bi-plus-circle"></i> Tambah ke Stok
                            </button>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="Asset/MG.JPG.jpg" class="d-block w-100" alt="Minyak Goreng">
                        <div class="carousel-caption">
                            <h5>Minyak Goreng</h5>
                            <p>Minyak goreng murni dan higienis</p>
                            <button class="btn btn-sm btn-light mt-2" onclick="quickAddFromCatalog('MG001', 'Minyak Goreng 2L', 'asset/MG.JPG.jpg')">
                                <i class="bi bi-plus-circle"></i> Tambah ke Stok
                            </button>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="Asset/RT.JPG.jpg" class="d-block w-100" alt="Roti Tawar">
                        <div class="carousel-caption">
                            <h5>Roti Tawar</h5>
                            <p>Roti segar setiap hari</p>
                            <button class="btn btn-sm btn-light mt-2" onclick="quickAddFromCatalog('RT001', 'Roti Tawar', 'asset/RT.JPG.jpg')">
                                <i class="bi bi-plus-circle"></i> Tambah ke Stok
                            </button>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="Asset/SS.JPG.jpg" class="d-block w-100" alt="Susu">
                        <div class="carousel-caption">
                            <h5>Susu UHT</h5>
                            <p>Susu bergizi untuk keluarga</p>
                            <button class="btn btn-sm btn-light mt-2" onclick="quickAddFromCatalog('SS001', 'Susu UHT 1L', 'asset/SS.JPG.jpg')">
                                <i class="bi bi-plus-circle"></i> Tambah ke Stok
                            </button>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="Asset/TT.JPG.jpg" class="d-block w-100" alt="Tepung Terigu">
                        <div class="carousel-caption">
                            <h5>Tepung Terigu</h5>
                            <p>Tepung berkualitas premium</p>
                            <button class="btn btn-sm btn-light mt-2" onclick="quickAddFromCatalog('TT001', 'Tepung Terigu 1kg', 'asset/TT.JPG.jpg')">
                                <i class="bi bi-plus-circle"></i> Tambah ke Stok
                            </button>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="Asset/TT1.JPG.jpg" class="d-block w-100" alt="Teh">
                        <div class="carousel-caption">
                            <h5>Teh Celup</h5>
                            <p>Teh pilihan dengan aroma khas</p>
                            <button class="btn btn-sm btn-light mt-2" onclick="quickAddFromCatalog('TT101', 'Teh Celup', 'asset/TT1.JPG.jpg')">
                                <i class="bi bi-plus-circle"></i> Tambah ke Stok
                            </button>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-3">
        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalItems">0</div>
                <div class="stat-label">Total Barang</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="lowStockCount">0</div>
                <div class="stat-label">Stok Rendah</div>
            </div>
        </div>

        <!-- Search -->
        <div class="search-container">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="searchInput" placeholder="Cari nama atau kode barang...">
            </div>
        </div>

        <!-- Stock List -->
        <div id="stockList"></div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="container">
            <div class="row">
                <div class="col">
                    <a href="#" class="nav-item-bottom" onclick="showAddModal(); return false;">
                        <i class="bi bi-plus-circle-fill"></i>
                        <span>Tambah</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="nav-item-bottom" onclick="renderStockList(); return false;">
                        <i class="bi bi-list-ul"></i>
                        <span>Daftar</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Item -->
    <div class="modal fade" id="itemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Tambah Barang Baru</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <input type="hidden" id="itemId">
                        <div class="mb-3">
                            <label class="form-label">Kode Barang</label>
                            <input type="text" class="form-control" id="itemCode" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nama Barang</label>
                            <input type="text" class="form-control" id="itemName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Stok Awal</label>
                            <input type="number" class="form-control" id="itemStock" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Minimum Stok</label>
                            <input type="number" class="form-control" id="itemMinStock" min="0" value="10" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Foto Produk</label>
                            <div class="mb-2">
                                <select class="form-select mb-2" id="itemImageSelect" onchange="selectPresetImage()">
                                    <option value="">Pilih dari Daftar Sampel</option>
                                    <option value="asset/GL.JPG.jpg">GL.JPG.jpg - Gula</option>
                                    <option value="asset/MG.JPG.jpg">MG.JPG.jpg - Minyak Goreng</option>
                                    <option value="asset/RT.JPG.jpg">RT.JPG.jpg - Roti Tawar</option>
                                    <option value="asset/SS.JPG.jpg">SS.JPG.jpg - Susu</option>
                                    <option value="asset/TT.JPG.jpg">TT.JPG.jpg - Tepung Terigu</option>
                                    <option value="asset/TT1.JPG.jpg">TT1.JPG.jpg - Teh</option>
                                </select>
                                <div class="text-center my-2"><strong>ATAU</strong></div>
                                <input type="file" class="form-control" id="itemImageUpload" accept="image/*" onchange="handleImageUpload(event)">
                                <small class="form-text text-muted">Unggah foto sendiri (JPG, PNG, max 2MB)</small>
                            </div>
                            <input type="hidden" id="itemImage">
                            <div id="imagePreview" class="mt-2"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Video Barang</label>
                            <select class="form-select" id="itemVideo">
                                <option value="">Tanpa Video</option>
                                <option value="asset/V1.mp4">V1 - Video Produk</option>
                            </select>
                            <small class="form-text text-muted">Opsional: tambahkan video demonstrasi</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="saveItem()">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Stock Adjustment -->
    <div class="modal fade" id="stockModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="stockModalTitle">Sesuaikan Stok</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="adjustItemId">
                    <div class="mb-3">
                        <label class="form-label">Barang</label>
                        <input type="text" class="form-control" id="adjustItemName" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Stok Saat Ini</label>
                        <input type="text" class="form-control" id="adjustCurrentStock" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Jumlah</label>
                        <input type="number" class="form-control" id="adjustAmount" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Keterangan (Opsional)</label>
                        <textarea class="form-control" id="adjustNote" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-success" onclick="adjustStock('add')">
                        <i class="bi bi-plus-lg"></i> Tambah Stok
                    </button>
                    <button type="button" class="btn btn-danger" onclick="adjustStock('subtract')">
                        <i class="bi bi-dash-lg"></i> Kurangi Stok
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Item Detail -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Barang</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="detailContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Anime.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <script>
        let stockData = [];
        let itemModal, stockModal, detailModal;
        let catalogVisible = true;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            itemModal = new bootstrap.Modal(document.getElementById('itemModal'));
            stockModal = new bootstrap.Modal(document.getElementById('stockModal'));
            detailModal = new bootstrap.Modal(document.getElementById('detailModal'));
            
            loadData();
            renderStockList();
            
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', function() {
                renderStockList(this.value);
            });

            // Animate catalog section on load
            anime({
                targets: '.catalog-section',
                translateY: [-50, 0],
                opacity: [0, 1],
                duration: 800,
                easing: 'easeOutQuad',
                delay: 300
            });

            // Animate carousel caption
            anime({
                targets: '.carousel-caption',
                translateY: [30, 0],
                opacity: [0, 1],
                duration: 600,
                easing: 'easeOutQuad',
                delay: 800
            });
        });

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('cskStockData');
            if (saved) {
                stockData = JSON.parse(saved);
            } else {
                // Data contoh untuk demo
                stockData = [
                    {
                        id: '1',
                        code: 'GL001',
                        name: 'Gula Pasir 1kg',
                        stock: 50,
                        minStock: 10,
                        image: 'asset/GL.JPG.jpg',
                        video: ''
                    },
                    {
                        id: '2',
                        code: 'MG001',
                        name: 'Minyak Goreng 2L',
                        stock: 8,
                        minStock: 10,
                        image: 'asset/MG.JPG.jpg',
                        video: ''
                    },
                    {
                        id: '3',
                        code: 'RT001',
                        name: 'Roti Tawar',
                        stock: 25,
                        minStock: 5,
                        image: 'asset/RT.JPG.jpg',
                        video: ''
                    },
                    {
                        id: '4',
                        code: 'SS001',
                        name: 'Susu UHT 1L',
                        stock: 30,
                        minStock: 15,
                        image: 'asset/SS.JPG.jpg',
                        video: ''
                    },
                    {
                        id: '5',
                        code: 'TT001',
                        name: 'Tepung Terigu 1kg',
                        stock: 15,
                        minStock: 10,
                        image: 'asset/TT.JPG.jpg',
                        video: ''
                    },
                    {
                        id: '6',
                        code: 'TT101',
                        name: 'Teh Celup',
                        stock: 40,
                        minStock: 20,
                        image: 'asset/TT1.JPG.jpg',
                        video: ''
                    }
                ];
                saveData();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('cskStockData', JSON.stringify(stockData));
        }

        // Render stock list
        function renderStockList(searchTerm = '') {
            const container = document.getElementById('stockList');
            const filtered = stockData.filter(item => 
                item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.code.toLowerCase().includes(searchTerm.toLowerCase())
            );

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <h5>Belum Ada Barang</h5>
                        <p>Klik tombol "Tambah" untuk menambahkan barang baru</p>
                    </div>
                `;
                updateStats();
                return;
            }

            container.innerHTML = filtered.map(item => {
                const isLowStock = item.stock <= item.minStock;
                const isUploadedImage = item.image && item.image.startsWith('data:');
                const imageClass = isUploadedImage ? 'item-image uploaded' : 'item-image';
                const imageHtml = item.image ? `<img src="${item.image}" class="${imageClass}" alt="${item.name}" onerror="this.style.display='none'">` : '';
                return `
                    <div class="stock-card ${isLowStock ? 'low-stock' : ''}" data-item-id="${item.id}">
                        <div class="stock-info">
                            <div class="item-content">
                                ${imageHtml}
                                <div>
                                    <div class="stock-name">
                                        ${item.name}
                                        ${isUploadedImage ? '<i class="bi bi-camera-fill text-success" title="Foto diunggah"></i>' : ''}
                                        ${isLowStock ? '<span class="badge-warning"><i class="bi bi-exclamation-triangle-fill"></i> Rendah</span>' : ''}
                                    </div>
                                    <div class="stock-code">${item.code}</div>
                                </div>
                            </div>
                            <div class="stock-quantity ${isLowStock ? 'low' : ''}" data-stock="${item.id}">
                                ${item.stock}
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-info btn-action text-white" onclick="viewItemDetail('${item.id}')">
                                <i class="bi bi-eye"></i> Detail
                            </button>
                            <button class="btn btn-success btn-action" onclick="showStockModal('${item.id}')">
                                <i class="bi bi-arrow-down-up"></i> Sesuaikan
                            </button>
                            <button class="btn btn-primary btn-action" onclick="editItem('${item.id}')">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-action" onclick="deleteItem('${item.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Animate cards
            anime({
                targets: '.stock-card',
                translateY: [20, 0],
                opacity: [0, 1],
                delay: anime.stagger(50),
                duration: 500,
                easing: 'easeOutQuad'
            });

            updateStats();
        }

        // Update statistics
        function updateStats() {
            const lowStockItems = stockData.filter(item => item.stock <= item.minStock);
            document.getElementById('totalItems').textContent = stockData.length;
            document.getElementById('lowStockCount').textContent = lowStockItems.length;
            
            anime({
                targets: '.stat-number',
                scale: [1.2, 1],
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        // Show add modal
        function showAddModal() {
            document.getElementById('modalTitle').textContent = 'Tambah Barang Baru';
            document.getElementById('itemForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('itemImage').value = '';
            document.getElementById('itemImageSelect').value = '';
            document.getElementById('itemImageUpload').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            itemModal.show();
            
            anime({
                targets: '.modal-content',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('Ukuran file terlalu besar! Maksimal 2MB');
                event.target.value = '';
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('File harus berupa gambar!');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                document.getElementById('itemImage').value = base64Image;
                document.getElementById('itemImageSelect').value = '';
                
                // Show preview
                document.getElementById('imagePreview').innerHTML = `
                    <img src="${base64Image}" alt="Preview">
                    <p class="mt-2 text-success"><i class="bi bi-check-circle"></i> Foto berhasil diunggah</p>
                `;
            };
            reader.readAsDataURL(file);
        }

        // Select preset image
        function selectPresetImage() {
            const select = document.getElementById('itemImageSelect');
            const imagePath = select.value;
            
            if (imagePath) {
                document.getElementById('itemImage').value = imagePath;
                document.getElementById('itemImageUpload').value = '';
                
                // Show preview
                document.getElementById('imagePreview').innerHTML = `
                    <img src="${imagePath}" alt="Preview" onerror="this.parentElement.innerHTML='<p class=text-danger>Gambar tidak dapat dimuat</p>'">
                    <p class="mt-2 text-success"><i class="bi bi-check-circle"></i> Foto sampel dipilih</p>
                `;
            } else {
                document.getElementById('itemImage').value = '';
                document.getElementById('imagePreview').innerHTML = '';
            }
        }

        // Save item
        function saveItem() {
            const id = document.getElementById('itemId').value;
            const code = document.getElementById('itemCode').value;
            const name = document.getElementById('itemName').value;
            const stock = parseInt(document.getElementById('itemStock').value);
            const minStock = parseInt(document.getElementById('itemMinStock').value);
            const image = document.getElementById('itemImage').value;
            const video = document.getElementById('itemVideo').value;

            if (!code || !name || isNaN(stock) || isNaN(minStock)) {
                alert('Mohon isi semua field dengan benar');
                return;
            }

            if (id) {
                const index = stockData.findIndex(item => item.id === id);
                stockData[index] = { ...stockData[index], code, name, stock, minStock, image, video };
            } else {
                const newItem = {
                    id: Date.now().toString(),
                    code,
                    name,
                    stock,
                    minStock,
                    image,
                    video
                };
                stockData.push(newItem);
            }

            saveData();
            renderStockList();
            itemModal.hide();
            showNotification('Barang berhasil disimpan!', '#28A745');
        }

        // Edit item
        function editItem(id) {
            const item = stockData.find(i => i.id === id);
            if (!item) return;

            document.getElementById('modalTitle').textContent = 'Edit Barang';
            document.getElementById('itemId').value = item.id;
            document.getElementById('itemCode').value = item.code;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemStock').value = item.stock;
            document.getElementById('itemMinStock').value = item.minStock;
            document.getElementById('itemImage').value = item.image || '';
            document.getElementById('itemVideo').value = item.video || '';
            
            // Show current image
            if (item.image) {
                if (item.image.startsWith('data:')) {
                    // Base64 image
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${item.image}" alt="Current">
                        <p class="mt-2 text-info"><i class="bi bi-info-circle"></i> Foto saat ini (diunggah)</p>
                    `;
                    document.getElementById('itemImageSelect').value = '';
                } else {
                    // Preset image
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${item.image}" alt="Current" onerror="this.parentElement.innerHTML='<p class=text-danger>Gambar tidak dapat dimuat</p>'">
                        <p class="mt-2 text-info"><i class="bi bi-info-circle"></i> Foto saat ini (sampel)</p>
                    `;
                    document.getElementById('itemImageSelect').value = item.image;
                }
            } else {
                document.getElementById('imagePreview').innerHTML = '';
                document.getElementById('itemImageSelect').value = '';
            }
            
            document.getElementById('itemImageUpload').value = '';
            
            itemModal.show();
        }

        // Delete item
        function deleteItem(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus barang ini?')) return;

            stockData = stockData.filter(item => item.id !== id);
            saveData();
            renderStockList();
            showNotification('Barang berhasil dihapus!', '#DC3545');
        }

        // Show stock adjustment modal
        function showStockModal(id) {
            const item = stockData.find(i => i.id === id);
            if (!item) return;

            document.getElementById('adjustItemId').value = item.id;
            document.getElementById('adjustItemName').value = item.name;
            document.getElementById('adjustCurrentStock').value = item.stock;
            document.getElementById('adjustAmount').value = '';
            document.getElementById('adjustNote').value = '';
            
            stockModal.show();
            
            anime({
                targets: '#stockModal .modal-content',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        // Adjust stock
        function adjustStock(type) {
            const id = document.getElementById('adjustItemId').value;
            const amount = parseInt(document.getElementById('adjustAmount').value);

            if (isNaN(amount) || amount <= 0) {
                alert('Mohon masukkan jumlah yang valid');
                return;
            }

            const item = stockData.find(i => i.id === id);
            if (!item) return;

            if (type === 'add') {
                item.stock += amount;
                showNotification(`Stok ${item.name} bertambah ${amount}`, '#28A745');
            } else {
                if (item.stock < amount) {
                    alert('Stok tidak mencukupi!');
                    return;
                }
                item.stock -= amount;
                showNotification(`Stok ${item.name} berkurang ${amount}`, '#007BFF');
            }

            saveData();
            stockModal.hide();
            renderStockList();

            // Animate stock number
            const stockElement = document.querySelector(`[data-stock="${id}"]`);
            if (stockElement) {
                anime({
                    targets: stockElement,
                    scale: [1.5, 1],
                    color: ['#28A745', type === 'add' ? '#28A745' : '#007BFF', item.stock <= item.minStock ? '#DC3545' : '#007BFF'],
                    duration: 600,
                    easing: 'easeOutElastic(1, .6)'
                });
            }
        }

        // Show notification
        function showNotification(message, color) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = color;
            notification.style.display = 'block';

            anime({
                targets: notification,
                translateX: [400, 0],
                opacity: [0, 1],
                duration: 400,
                easing: 'easeOutQuad'
            });

            setTimeout(() => {
                anime({
                    targets: notification,
                    translateX: [0, 400],
                    opacity: [1, 0],
                    duration: 400,
                    easing: 'easeInQuad',
                    complete: () => {
                        notification.style.display = 'none';
                    }
                });
            }, 3000);
        }

        // Refresh data
        function refreshData() {
            anime({
                targets: '.container',
                rotateZ: [0, 360],
                duration: 500,
                easing: 'easeInOutQuad'
            });
            
            renderStockList();
            showNotification('Data berhasil diperbarui!', '#007BFF');
        }

        // View item detail
        function viewItemDetail(id) {
            const item = stockData.find(i => i.id === id);
            if (!item) return;

            let imageHtml = '';
            let videoHtml = '';

            if (item.image) {
                const imageType = item.image.startsWith('data:') ? 'Foto Diunggah' : 'Foto Sampel';
                imageHtml = `
                    <div class="media-preview">
                        <h6>Foto Produk: <small class="text-muted">(${imageType})</small></h6>
                        <img src="${item.image}" alt="${item.name}" onerror="this.parentElement.innerHTML='<p class=text-muted>Gambar tidak dapat dimuat</p>'">
                    </div>
                `;
            }

            if (item.video) {
                videoHtml = `
                    <div class="media-preview">
                        <h6>Video Barang:</h6>
                        <video controls>
                            <source src="${item.video}" type="video/mp4">
                            Browser Anda tidak mendukung video.
                        </video>
                    </div>
                `;
            }

            const detailHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <strong>Kode Barang:</strong>
                        <p>${item.code}</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Nama Barang:</strong>
                        <p>${item.name}</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Stok Saat Ini:</strong>
                        <p class="stock-quantity">${item.stock}</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Minimum Stok:</strong>
                        <p>${item.minStock}</p>
                    </div>
                    <div class="col-md-12 mb-3">
                        <strong>Status:</strong>
                        <p>${item.stock <= item.minStock ? '<span class="badge bg-danger">Stok Rendah</span>' : '<span class="badge bg-success">Stok Aman</span>'}</p>
                    </div>
                </div>
                ${imageHtml}
                ${videoHtml}
            `;

            document.getElementById('detailContent').innerHTML = detailHtml;
            detailModal.show();

            anime({
                targets: '#detailModal .modal-content',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        // Toggle catalog visibility
        function toggleCatalog() {
            const content = document.getElementById('catalogContent');
            const icon = document.getElementById('catalogToggleIcon');
            
            if (catalogVisible) {
                anime({
                    targets: content,
                    height: 0,
                    opacity: 0,
                    duration: 400,
                    easing: 'easeInOutQuad',
                    complete: () => {
                        content.style.display = 'none';
                    }
                });
                icon.className = 'bi bi-chevron-down';
            } else {
                content.style.display = 'block';
                anime({
                    targets: content,
                    height: [0, 'auto'],
                    opacity: [0, 1],
                    duration: 400,
                    easing: 'easeInOutQuad'
                });
                icon.className = 'bi bi-chevron-up';
            }
            catalogVisible = !catalogVisible;
        }

        // Quick add from catalog
        function quickAddFromCatalog(code, name, image) {
            // Check if product already exists
            const exists = stockData.find(item => item.code === code);
            if (exists) {
                if (confirm(`${name} sudah ada di stok. Ingin menambah jumlah stok?`)) {
                    showStockModal(exists.id);
                }
                return;
            }

            // Pre-fill modal with catalog data
            document.getElementById('modalTitle').textContent = 'Tambah Barang dari Katalog';
            document.getElementById('itemForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('itemCode').value = code;
            document.getElementById('itemName').value = name;
            document.getElementById('itemStock').value = '0';
            document.getElementById('itemMinStock').value = '10';
            document.getElementById('itemImage').value = image;
            document.getElementById('itemImageSelect').value = image;
            document.getElementById('itemImageUpload').value = '';
            
            // Show preview
            document.getElementById('imagePreview').innerHTML = `
                <img src="${image}" alt="Preview" onerror="this.parentElement.innerHTML='<p class=text-danger>Gambar tidak dapat dimuat</p>'">
                <p class="mt-2 text-success"><i class="bi bi-check-circle"></i> Foto katalog dipilih</p>
            `;
            
            itemModal.show();
            
            showNotification('Data katalog dimuat! Silakan isi jumlah stok', '#007BFF');
        }
    </script>
</body>
</html>